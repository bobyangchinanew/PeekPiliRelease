# 🐘 PHP 运行环境使用指南

> 本版本新增了内置 PHP 运行环境，让你可以使用更多 T4 类型的视频源！

---

## 📖 这是什么？

**PHP 运行环境** 是一个让 PeekPili 能够运行 PHP 格式爬虫脚本的功能。

简单来说：
- 🎬 一些影视源使用 PHP 语言编写
- 📱 以前只能在电脑上用，手机不支持
- ✨ 现在 PeekPili 内置了 PHP 运行环境，手机也能用了！

---

## 🚀 快速上手

### 第一步：找到入口

打开 PeekPili → **设置** → **实验室** → **PHP 运行环境**

### 第二步：安装 PHP（仅安卓需要）

| 平台 | 安装方式 |
|------|---------|
| 安卓 | 点击「安装 PHP」按钮，等待下载完成（约 50MB） |
| Windows | 已内置，无需安装 |

> 💡 **提示**：首次下载需要网络，请确保网络通畅

### 第三步：启动服务

1. 设置端口号（默认 `9980`，一般不用改）
2. 点击「**启动服务**」按钮
3. 看到状态变成 ✅ **运行中** 就成功了

---

## 🎯 界面功能说明

### 主界面元素

| 区域 | 功能 | 说明 |
|------|------|------|
| 📊 **运行状态** | 显示服务状态 | 红色=未安装，黄色=已停止，绿色=运行中 |
| 🔢 **端口配置** | 设置服务端口 | 范围 1024-65535，默认 9980 |
| ▶️ **启动/停止** | 控制服务开关 | 绿色按钮启动，红色按钮停止 |
| 📁 **PHP 脚本目录** | 管理脚本文件 | 存放 .php 格式的爬虫源 |
| 🧩 **已加载扩展** | 查看 PHP 扩展 | 显示支持的功能模块 |
| 💡 **使用说明** | T4 源配置示例 | 教你怎么添加源 |

### 脚本文件列表

每个脚本文件都有以下操作：

| 操作 | 说明 |
|------|------|
| 📝 **编辑/测试** | 进入脚本编辑器（安卓为只读模式） |
| 🔗 **复制地址** | 复制脚本的访问 URL（服务运行时可用） |

---

## 📂 脚本目录在哪？

### 安卓

```
/storage/emulated/0/peekpili/php-scripts/
```

> 💡 可以用 **MT管理器**、**ES文件管理器** 等工具访问这个目录

### Windows

```
程序安装目录\data\php\scripts\
```

---

## 📝 添加 PHP 源教程

### 步骤一：获取 PHP 脚本

从源作者那里获取 `.php` 格式的爬虫脚本文件

### 步骤二：放入脚本目录

1. 打开文件管理器
2. 找到上面说的脚本目录
3. 把 `.php` 文件复制进去
4. 回到 PHP 运行环境页面，点击 **刷新** 确认文件已识别

### 步骤三：添加 T4 源

在 T4 源管理中添加源配置：

```json
{
  "key": "myphp",
  "name": "我的PHP源",
  "type": 4,
  "api": "http://127.0.0.1:9980/脚本名.php",
  "searchable": 1,
  "quickSearch": 1,
  "changeable": 0
}
```

#### 字段说明

| 字段 | 说明 | 示例 |
|------|------|------|
| `key` | 唯一标识，自定义英文名 | `"myphp"` |
| `name` | 显示名称，随意填写 | `"我的PHP源"` |
| `type` | 固定填 4（T4 类型） | `4` |
| `api` | PHP 脚本地址 | `"http://127.0.0.1:9980/example.php"` |
| `searchable` | 是否支持搜索（1=是，0=否） | `1` |
| `quickSearch` | 是否支持快搜（1=是，0=否） | `1` |

### 步骤四：开始使用

1. 确保 PHP 服务已启动（状态为绿色）
2. 在首页或搜索中选择刚添加的源
3. 正常使用即可！

---

## 🧪 脚本测试功能

点击脚本列表中的「测试」按钮，可以进入测试页面。

### 可测试的接口

| 接口 | 用途 | 需要参数 |
|------|------|---------|
| 🏠 **首页/分类** | 测试首页内容 | 无 |
| 📑 **分类列表** | 测试分类下的视频列表 | 分类ID、筛选参数 |
| 🔍 **搜索** | 测试搜索功能 | 搜索关键词 |
| 📄 **详情** | 测试视频详情页 | 视频ID |
| ▶️ **播放** | 测试播放链接解析 | 线路、播放ID |

### 如何测试

1. 选择要测试的接口类型
2. 填写必要的参数（如搜索关键词）
3. 点击「**运行测试**」
4. 查看下方的测试结果

> 💡 也可以点击「浏览器打开」在浏览器中查看原始返回数据

---

## ❓ 常见问题

### Q: 安装失败怎么办？

**A:** 检查以下几点：
1. 确保网络连接正常
2. 存储空间是否充足（需要约 100MB）
3. 尝试使用 VPN 或切换网络

### Q: 启动服务失败？

**A:** 可能的原因：
1. 端口被占用 → 换一个端口号（如 9981）
2. PHP 安装不完整 → 重新安装
3. 权限问题 → 安卓需要授予存储权限

### Q: 脚本不显示在列表中？

**A:** 检查以下几点：
1. 文件后缀是否为 `.php`
2. 文件是否放在正确的目录
3. 点击刷新按钮重新加载

### Q: 源无法使用？

**A:** 按顺序排查：
1. PHP 服务是否已启动（状态为绿色）
2. 脚本是否已放入目录
3. T4 源配置中的 api 地址是否正确
4. 使用测试功能检查脚本是否有错误

### Q: 安卓为什么不能编辑脚本？

**A:** 为了方便管理，安卓端设计为只读模式。你可以：
- 使用 **MT管理器** 等第三方编辑器编辑 `.php` 文件
- 在电脑上编辑好后传到手机

---

## 🔧 技术信息

| 项目 | 说明 |
|------|------|
| PHP 版本 | 8.x（具体版本见页面显示） |
| 默认端口 | 9980 |
| 服务地址 | http://127.0.0.1:端口号 |
| 支持平台 | 安卓、Windows |

### 重要扩展支持

- ✅ curl（网络请求）
- ✅ json（JSON 处理）
- ✅ mbstring（中文支持）
- ✅ openssl（HTTPS 支持）
- ✅ dom / xml（HTML 解析）

---

## 📌 小贴士

1. **每次使用 PHP 源前，记得先启动服务**
2. **端口号不用频繁修改**，默认的 9980 一般就够用
3. **脚本目录和 drpy-node 同级**，方便统一管理
4. **有问题先看测试结果**，能帮你快速定位问题

---

> 🎉 恭喜你！现在可以开始使用 PHP 视频源了！

